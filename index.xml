<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title> :)</title>
    <link>https://leewei.co/</link>
    <description>Recent content on  :)</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <managingEditor>lee10202013@gmail.com (Lee Wei)</managingEditor>
    <webMaster>lee10202013@gmail.com (Lee Wei)</webMaster>
    <copyright>© 2024 Lee Wei</copyright>
    <lastBuildDate>Mon, 14 Apr 2025 13:21:15 -0700</lastBuildDate>
    <atom:link href="https://leewei.co/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>LLVM: Constraint Elimination Pass</title>
      <link>https://leewei.co/llvm-constraint/</link>
      <pubDate>Mon, 14 Apr 2025 13:21:15 -0700</pubDate><author>lee10202013@gmail.com (Lee Wei)</author>
      <guid>https://leewei.co/llvm-constraint/</guid>
      <description>Introduction Constraint Elimination is a transformation pass that extracts facts from LLVM IR and tries to replace certain uses with known facts. One common replacement is to replace conditional comparisons with constants (true or false) when known. The following is a simple example of how Constraint Elimination works.
1int foo(int x, int y) { 2 if (x &amp;gt; y) { // x &amp;gt; y is a known fact in this block 3 if (x &amp;lt;= y) { // replace x &amp;lt;= y with false 4 return 2; 5 } 6 return 1; 7 } 8 9 return 0; 10} 11 12// after constraint elimination 13int foo(int x, int y) { 14 if (x &amp;gt; y) { 15 if (false) { // block can be removed 16 return 2; 17 } 18 return 1; 19 } 20 21 return 0; 22} The logic behind Constraint Elimination relies on an analysis pass called the Constraint System.</description>
      <content:encoded><![CDATA[<h3 id="introduction">Introduction</h3>
<p>Constraint Elimination is a transformation pass that extracts facts from LLVM IR and tries to replace certain uses with known facts. One common replacement is to replace conditional comparisons with constants (true or false) when known. The following is a simple example of how Constraint Elimination works.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#f38ba8">int</span> <span style="color:#89b4fa">foo</span>(<span style="color:#f38ba8">int</span> x, <span style="color:#f38ba8">int</span> y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>  <span style="color:#cba6f7">if</span> (x <span style="color:#89dceb;font-weight:bold">&gt;</span> y) {    <span style="color:#6c7086;font-style:italic">// x &gt; y is a known fact in this block
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#6c7086;font-style:italic"></span>    <span style="color:#cba6f7">if</span> (x <span style="color:#89dceb;font-weight:bold">&lt;=</span> y) { <span style="color:#6c7086;font-style:italic">// replace x &lt;= y with false
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#6c7086;font-style:italic"></span>      <span style="color:#cba6f7">return</span> <span style="color:#fab387">2</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>    } 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>    <span style="color:#cba6f7">return</span> <span style="color:#fab387">1</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>  } 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>  
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>  <span style="color:#cba6f7">return</span> <span style="color:#fab387">0</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span><span style="color:#6c7086;font-style:italic">// after constraint elimination
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span><span style="color:#6c7086;font-style:italic"></span><span style="color:#f38ba8">int</span> <span style="color:#89b4fa">foo</span>(<span style="color:#f38ba8">int</span> x, <span style="color:#f38ba8">int</span> y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>  <span style="color:#cba6f7">if</span> (x <span style="color:#89dceb;font-weight:bold">&gt;</span> y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>    <span style="color:#cba6f7">if</span> (<span style="color:#89dceb">false</span>) { <span style="color:#6c7086;font-style:italic">// block can be removed
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span><span style="color:#6c7086;font-style:italic"></span>      <span style="color:#cba6f7">return</span> <span style="color:#fab387">2</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>    <span style="color:#cba6f7">return</span> <span style="color:#fab387">1</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>  } 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>  
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>  <span style="color:#cba6f7">return</span> <span style="color:#fab387">0</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>}</span></span></code></pre></div>
<p>The logic behind Constraint Elimination relies on an analysis pass called the Constraint System. Constraint Elimination stores known facts inside two constraint systems (signed and unsigned) and asks the constraint system if it&rsquo;s okay to replace uses.</p>
<h3 id="constraint-system">Constraint System</h3>
<p>The Constraint System stores known facts in the following form (c0 is constant, c1 to cn are coefficients, v1 to vn are variables):</p>
<p><code>c0 &lt;= c1 * v1 + c2 * v2 … + cn * vn</code></p>
<p>For instance, constraint <code>x &gt;= 0</code> will be decomposed into <code>0 &lt;= 1 * x</code> and constraint <code>y &gt;= 0</code> will be decomposed into <code>0 &lt;= 0 * x + 1 * y</code>. These two constraints are <code>true</code> in the constraint system, which implies a <strong>logical AND</strong> between them, resulting in <code>x &gt;= 0 &amp;&amp; y &gt;= 0</code>.</p>
<p>Constraint Elimination will ask the constraint system whether a constraint (<code>A</code>) is implied by adding a negation of the constraint (<code>!A</code>) into the system. Since constraints are combined with logical AND, the system becomes <code>C1 &amp;&amp; C2 &amp;&amp; ... &amp;&amp; Cn &amp;&amp; !A</code>. If this is satisfiable (sat), there’s a solution where <code>A</code> is false, so <code>A</code> isn’t implied by the existing constraints. If unsatisfiable (unsat), no solution exists where <code>A</code> is false, meaning <code>A</code> must be true whenever the existing constraints hold. For example, with constraints <code>A &amp;&amp; B</code>, checking <code>A</code> by adding <code>!A</code> gives <code>A &amp;&amp; B &amp;&amp; !A</code>, which is unsat (a contradiction). Thus, <code>A</code> is implied and can be safely replaced with <code>true</code> in the ConstraintElimination pass.</p>
<p>Now that we understand how constraints are handled, let’s dive into the core of the Constraint Elimination pass.</p>
<h3 id="constraint-elimination">Constraint Elimination</h3>
<p>The Constraint Elimination pass works roughly as follows:</p>
<ol>
<li>Perform a Depth-First search the dominator tree and add entries to a worklist for every basic block. An entry can be a Fact to be added or a Check that needs to check if it can be replaced.</li>
<li>Sort the worklist by dominance information from the dominator tree.</li>
<li>Process sorted worklist and replace implied conditions.</li>
<li>Remove instructions with no uses inside the function.</li>
</ol>
<p>Constraint Elimination begins by traversing the <code>entry</code> block and iterates over every instruction. If there&rsquo;s a comparison instruction <code>icmp</code>, it adds an entry <code>UseCheck</code> into the worklist to check if it can be replaced later. If the terminator is a conditional branch, it adds corresponding facts to the successor blocks.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>define i1 <span style="color:#f38ba8">@</span>src(i4 <span style="color:#89dceb;font-weight:bold">%</span>x, i4 <span style="color:#89dceb;font-weight:bold">%</span>y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#89dceb">entry</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span> <span style="color:#89dceb;font-weight:bold">=</span> icmp slt i4 <span style="color:#89dceb;font-weight:bold">%</span>x, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span>  br i1 <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span>, label <span style="color:#89dceb;font-weight:bold">%</span>t, label <span style="color:#89dceb;font-weight:bold">%</span>f
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span><span style="color:#89dceb">t</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span>  ...x <span style="color:#89dceb;font-weight:bold">&lt;</span> <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">7</span><span><span style="color:#89dceb">f</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">8</span><span>  ...x <span style="color:#89dceb;font-weight:bold">&gt;=</span> <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">9</span><span>}</span></span></code></pre></div>
<p>Branching to block <code>t</code> means that <code>%c.1</code> is true, where it can safely add <code>x &lt; 0</code> constraint to block <code>t</code>. On the other hand, it will invert the predicate to <code>x &gt;= 0</code> and add this constraint to block <code>f</code>. It will traverse to the next basic block and do the same until it traverses every basic block in the dominator tree.</p>
<p>Consider another example: block <code>t</code> is reached if <code>x &lt; 0 || y &lt; 0</code>. However, as mentioned earlier that the current constraint system has an implicit logical AND for every fact, constraint elimination cannot add this fact <code>x &lt; 0 || y &lt; 0</code> into the constraint system. As for block <code>f</code>, it can add the inverse of predicate <code>x &gt;= 0 &amp;&amp; y &gt;= 0</code> into the constraint system.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>define i1 <span style="color:#f38ba8">@</span>src(i4 <span style="color:#89dceb;font-weight:bold">%</span>x, i4 <span style="color:#89dceb;font-weight:bold">%</span>y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span><span style="color:#89dceb">entry</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span> <span style="color:#89dceb;font-weight:bold">=</span> icmp slt i4 <span style="color:#89dceb;font-weight:bold">%</span>x, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.2</span> <span style="color:#89dceb;font-weight:bold">=</span> icmp slt i4 <span style="color:#89dceb;font-weight:bold">%</span>y, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>or <span style="color:#89dceb;font-weight:bold">=</span> or i1 <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span>, <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.2</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>  br i1 <span style="color:#89dceb;font-weight:bold">%</span>or, label <span style="color:#89dceb;font-weight:bold">%</span>t, label <span style="color:#89dceb;font-weight:bold">%</span>f
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span><span style="color:#89dceb">t</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>  ret i1 <span style="color:#89dceb">false</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span><span style="color:#89dceb">f</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>cmp <span style="color:#89dceb;font-weight:bold">=</span> icmp sge i4 <span style="color:#89dceb;font-weight:bold">%</span>x, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>  ret i1 <span style="color:#89dceb;font-weight:bold">%</span>cmp
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>}</span></span></code></pre></div>
<p>Below is the worklist after traversing all blocks in the function and sorting the worklist. <code>NumIn</code> and <code>NumOut</code> represent the sequence for the Depth-first search. The sorted entries follow these rules <code>NumIn &lt; ConditionFact &lt; Check &lt; InstrBefore</code>, where blocks with lower NumIn values dominate those with higher ones. In the same basic block, condition facts are processed before <code>UseCheck</code>.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span><span style="color:#6c7086;font-style:italic">// entry NumIn=0, NumOut=5
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#6c7086;font-style:italic">// t     NumIn=1, Numout=2
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#6c7086;font-style:italic">// f     NumIn=3, Numout=4
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span><span style="color:#6c7086;font-style:italic"></span>UseCheck(<span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span>, ICMP_SLT, <span style="color:#89dceb;font-weight:bold">%</span>x, <span style="color:#fab387">0</span>, NumIn<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">0</span>, NumOut<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">5</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span>UseCheck(<span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.2</span>, ICMP_SLT, <span style="color:#89dceb;font-weight:bold">%</span>y, <span style="color:#fab387">0</span>, NumIn<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">0</span>, NumOut<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">5</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span>ConditionFact(DT.getNode(f), ICMP_SGE, <span style="color:#89dceb;font-weight:bold">%</span>x, <span style="color:#fab387">0</span>, NumIn<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">3</span>, NumOut<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">4</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">7</span><span>ConditionFact(DT.getNode(f), ICMP_SGE, <span style="color:#89dceb;font-weight:bold">%</span>y, <span style="color:#fab387">0</span>, NumIn<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">3</span>, NumOut<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">4</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">8</span><span>UseCheck(<span style="color:#89dceb;font-weight:bold">%</span>cmp, ICMP_SGE, <span style="color:#89dceb;font-weight:bold">%</span>x, <span style="color:#fab387">0</span>, NumIn<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">3</span>, NumOut<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#fab387">4</span>)</span></span></code></pre></div>
<p>By processing the above worklist, constraint elimination learns that it can replace <code>%cmp</code> with <code>true</code> in block <code>f</code> (see <a href="https://alive2.llvm.org/ce/z/MvjjwH">Alive2 proof</a> — a tool to verify LLVM IR optimizations), and safely remove <code>%cmp = icmp sge i4 %x, 0</code> instruction.</p>
<h3 id="missing-cases">Missing Cases</h3>
<p>As of writing, I have submitted a <a href="https://github.com/llvm/llvm-project/pull/132124">PR</a> to add optimization opportunities for Constraint Elimination. The pass adds additional facts if the condition being analyzed matches one of the following four patterns.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span><span style="color:#6c7086;font-style:italic"># bitwise OR</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#89dceb;font-weight:bold">(</span>LHS | RHS &gt;<span style="color:#89dceb;font-weight:bold">=</span> 0<span style="color:#89dceb;font-weight:bold">)</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; LHS &gt;<span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#fab387">0</span> <span style="color:#89dceb;font-weight:bold">&amp;&amp;</span> RHS &gt;<span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#89dceb;font-weight:bold">(</span>LHS | RHS &gt; -1<span style="color:#89dceb;font-weight:bold">)</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt; LHS &gt;<span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#fab387">0</span> <span style="color:#89dceb;font-weight:bold">&amp;&amp;</span> RHS &gt;<span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span><span style="color:#6c7086;font-style:italic"># bitwise AND</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span><span style="color:#89dceb;font-weight:bold">(</span>LHS &amp; RHS &lt; 0<span style="color:#89dceb;font-weight:bold">)</span>   <span style="color:#89dceb;font-weight:bold">=</span>&gt;  LHS &lt; <span style="color:#fab387">0</span> <span style="color:#89dceb;font-weight:bold">&amp;&amp;</span> RHS &lt; <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span><span style="color:#89dceb;font-weight:bold">(</span>LHS &amp; RHS &lt;<span style="color:#89dceb;font-weight:bold">=</span> -1<span style="color:#89dceb;font-weight:bold">)</span> <span style="color:#89dceb;font-weight:bold">=</span>&gt;  LHS &lt; <span style="color:#fab387">0</span> <span style="color:#89dceb;font-weight:bold">&amp;&amp;</span> RHS &lt; <span style="color:#fab387">0</span></span></span></code></pre></div>
<p>This example demonstrates how my PR works. Before my PR, constraint elimination would only add one fact <code>%and.1 &lt; 0</code> to block <code>then</code>. With the added facts <code>x &lt; 0 &amp;&amp; y &lt; 0</code> in the <code>then</code> block, the pass can replace <code>%t.1</code> and <code>%t.2</code> with <code>true</code>.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#6c7086;font-style:italic">// before
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span><span style="color:#6c7086;font-style:italic"></span>define <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>src(i4 <span style="color:#89dceb;font-weight:bold">%</span>x, i4 <span style="color:#89dceb;font-weight:bold">%</span>y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#89dceb">entry</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>and<span style="color:#fab387">.1</span> <span style="color:#89dceb;font-weight:bold">=</span> and i4 <span style="color:#89dceb;font-weight:bold">%</span>y, <span style="color:#89dceb;font-weight:bold">%</span>x
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span><span style="color:#89dceb;font-weight:bold">=</span> icmp slt i4 <span style="color:#89dceb;font-weight:bold">%</span>and<span style="color:#fab387">.1</span>, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>  br i1 <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span>, label <span style="color:#89dceb;font-weight:bold">%</span>then, label <span style="color:#89dceb;font-weight:bold">%</span>end
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span><span style="color:#89dceb">then</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>  ; <span style="color:#89dceb">fact</span>: <span style="color:#89dceb;font-weight:bold">%</span>and<span style="color:#fab387">.1</span> <span style="color:#89dceb;font-weight:bold">&lt;</span> <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>t<span style="color:#fab387">.1</span> <span style="color:#89dceb;font-weight:bold">=</span> icmp slt i4 <span style="color:#89dceb;font-weight:bold">%</span>x, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>t<span style="color:#fab387">.2</span> <span style="color:#89dceb;font-weight:bold">=</span> icmp slt i4 <span style="color:#89dceb;font-weight:bold">%</span>y, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>  call <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>use(i1 <span style="color:#89dceb;font-weight:bold">%</span>t<span style="color:#fab387">.1</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>  call <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>use(i1 <span style="color:#89dceb;font-weight:bold">%</span>t<span style="color:#fab387">.2</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>  ret <span style="color:#f38ba8">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span><span style="color:#89dceb">end</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>  ret <span style="color:#f38ba8">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span><span style="color:#6c7086;font-style:italic">// after
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span><span style="color:#6c7086;font-style:italic"></span>define <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>tgt(i4 <span style="color:#89dceb;font-weight:bold">%</span>x, i4 <span style="color:#89dceb;font-weight:bold">%</span>y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span><span style="color:#89dceb">entry</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>and<span style="color:#fab387">.1</span> <span style="color:#89dceb;font-weight:bold">=</span> and i4 <span style="color:#89dceb;font-weight:bold">%</span>y, <span style="color:#89dceb;font-weight:bold">%</span>x
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span><span style="color:#89dceb;font-weight:bold">=</span> icmp slt i4 <span style="color:#89dceb;font-weight:bold">%</span>and<span style="color:#fab387">.1</span>, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">25</span><span>  br i1 <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span>, label <span style="color:#89dceb;font-weight:bold">%</span>then, label <span style="color:#89dceb;font-weight:bold">%</span>end
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">26</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">27</span><span><span style="color:#89dceb">then</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">28</span><span>  call <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>use(i1 <span style="color:#89dceb">true</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">29</span><span>  call <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>use(i1 <span style="color:#89dceb">true</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">30</span><span>  ret <span style="color:#f38ba8">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">31</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">32</span><span><span style="color:#89dceb">end</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">33</span><span>  ret <span style="color:#f38ba8">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">34</span><span>}</span></span></code></pre></div>
<h3 id="measure-replacement-counts">Measure Replacement Counts</h3>
<p>To evaluate the impact of my patch, I measured the number of replacements triggered by the Constraint Elimination pass. My approach is to print log whenever additional facts are added and replacement uses are triggered. This experiment was conducted on two projects, LLVM and Rust.</p>
<h4 id="building-llvm-with-ubsan-enabled">Building LLVM with UBSan enabled</h4>
<p>With UBSan enabled, building LLVM will go through a series of bound checks, firing more Constraint Elimination. The first build has my constraint elimination patch, and I commented out my patch in the second build.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#6c7086;font-style:italic"># $CC_HOME points to my locally built LLVM</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>cmake -GNinja -DCMAKE_CXX_COMPILER<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#f5e0dc">$CC_HOME</span>/bin/clang++ <span style="color:#89b4fa">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#89b4fa"></span>  -DCMAKE_C_COMPILER<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#f5e0dc">$CC_HOME</span>/bin/clang <span style="color:#89b4fa">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#89b4fa"></span>  -DCMAKE_BUILD_TYPE<span style="color:#89dceb;font-weight:bold">=</span>Release <span style="color:#89b4fa">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span><span style="color:#89b4fa"></span>  -DLLVM_ENABLE_PROJECTS<span style="color:#89dceb;font-weight:bold">=</span><span style="color:#a6e3a1">&#34;llvm;clang&#34;</span> <span style="color:#89b4fa">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span><span style="color:#89b4fa"></span>  -DLLVM_CCACHE_BUILD<span style="color:#89dceb;font-weight:bold">=</span>OFF -DLLVM_BUILD_EXAMPLES<span style="color:#89dceb;font-weight:bold">=</span>ON <span style="color:#89b4fa">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span><span style="color:#89b4fa"></span>  ../llvm -DLLVM_TARGETS_TO_BUILD<span style="color:#89dceb;font-weight:bold">=</span>X86 <span style="color:#89b4fa">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span><span style="color:#89b4fa"></span>  -DLLVM_USE_SANITIZER<span style="color:#89dceb;font-weight:bold">=</span>Undefined
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span><span style="color:#6c7086;font-style:italic"># without my patch</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>ninja -j <span style="color:#fab387">12</span> &gt; without.txt 2&gt;&amp;<span style="color:#fab387">1</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span><span style="color:#6c7086;font-style:italic"># with my constraint elimination patch</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>ninja -j <span style="color:#fab387">12</span> &gt; with.txt 2&gt;&amp;<span style="color:#fab387">1</span></span></span></code></pre></div>
<p>We observed that Constraint Elimination added several new facts while building LLVM.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span><span style="color:#6c7086;font-style:italic"># without my patch</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>$ cat ce2/without.txt | grep <span style="color:#a6e3a1">&#34;additional&#34;</span> | wc -l
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span><span style="color:#6c7086;font-style:italic"># with my constraint elimination patch</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span>$ cat ce2/with.txt | grep <span style="color:#a6e3a1">&#34;additional&#34;</span> | wc -l
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span><span style="color:#fab387">78</span></span></span></code></pre></div>
<p>We expected that the extra facts could trigger more replacements. However, the total number of replace count is the same.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#6c7086;font-style:italic"># without my patch</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>$ ./perform.sh ce/without.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>1: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#fab387">30428</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>2: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span><span style="color:#fab387">517</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>3: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>4: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>5: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>6: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span><span style="color:#fab387">7</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>7: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span><span style="color:#fab387">7</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>total replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span><span style="color:#fab387">30959</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span><span style="color:#6c7086;font-style:italic"># with my constraint elimination patch</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>$ ./perform.sh ce/with.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>1: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span><span style="color:#fab387">30428</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span>2: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">25</span><span><span style="color:#fab387">517</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">26</span><span>3: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">27</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">28</span><span>4: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">29</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">30</span><span>5: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">31</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">32</span><span>6: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">33</span><span><span style="color:#fab387">7</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">34</span><span>7: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">35</span><span><span style="color:#fab387">7</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">36</span><span>total replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">37</span><span><span style="color:#fab387">30959</span></span></span></code></pre></div>
<h4 id="building-rust-nightly">Building Rust nightly</h4>
<p>The result of the first experiment didn&rsquo;t meet what we expected, so we decided to see the result when compiling Rust.</p>
<p>As of writing, Rust nightly supports LLVM 20.x, so I had to rebuild my patch on top of LLVM 20. Luckily, there were no conflicts when I applied my updates to LLVM 20.x branch.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#6c7086;font-style:italic"># bootstrap.toml for building rustc</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>change-id <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#a6e3a1">&#34;ignore&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#89dceb;font-weight:bold">[</span>target.x86_64-unknown-linux-gnu<span style="color:#89dceb;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span><span style="color:#6c7086;font-style:italic"># set external llvm-config to get our locally built LLVM binaries</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>llvm-config <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#a6e3a1">&#34;/home/lee/dev/llvm-project/build/bin/llvm-config&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span><span style="color:#89dceb;font-weight:bold">[</span>llvm<span style="color:#89dceb;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>download-ci-llvm <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#89dceb">false</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>link-shared <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#89dceb">false</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span><span style="color:#89dceb;font-weight:bold">[</span>build<span style="color:#89dceb;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span><span style="color:#f5e0dc">extended</span> <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#89dceb">true</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span><span style="color:#6c7086;font-style:italic"># this needs to set to false, or rustc will try to build from in-tree LLVM</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>optimized-compiler-builtins <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#89dceb">false</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span><span style="color:#89dceb;font-weight:bold">[</span>rust<span style="color:#89dceb;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span><span style="color:#f5e0dc">channel</span> <span style="color:#89dceb;font-weight:bold">=</span> <span style="color:#a6e3a1">&#34;nightly&#34;</span></span></span></code></pre></div>
<p>Build stage2 <code>rustc</code> and <code>libstd</code>.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span><span style="color:#6c7086;font-style:italic"># without my patch</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>./x.py build --stage <span style="color:#fab387">2</span> 2&gt;&amp;<span style="color:#fab387">1</span> | tee without.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#6c7086;font-style:italic"># with my constraint elimination patch</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span>./x.py build --stage <span style="color:#fab387">2</span> 2&gt;&amp;<span style="color:#fab387">1</span> | tee with.txt</span></span></code></pre></div>
<p>Like we expected, there were additional facts added when compiling rustc.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>$ cat rust-ce/without.txt | grep <span style="color:#a6e3a1">&#34;additional&#34;</span> | wc -l
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>$ cat rust-ce/with.txt | grep <span style="color:#a6e3a1">&#34;additional&#34;</span> | wc -l
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span><span style="color:#fab387">304</span></span></span></code></pre></div>
<p>Finally, the result is similar to building LLVM. There was no difference in replacement count.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#6c7086;font-style:italic"># without my patch</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>$ ./perform.sh rust-ce/without.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>1: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#fab387">594755</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>2: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span><span style="color:#fab387">57</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>3: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>4: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>5: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>6: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>7: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>total replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span><span style="color:#fab387">594812</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span><span style="color:#6c7086;font-style:italic"># with my constraint elimination patch</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>$ ./perform.sh rust-ce/with.txt
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>1: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span><span style="color:#fab387">594755</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span>2: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">25</span><span><span style="color:#fab387">57</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">26</span><span>3: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">27</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">28</span><span>4: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">29</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">30</span><span>5: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">31</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">32</span><span>6: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">33</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">34</span><span>7: replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">35</span><span><span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">36</span><span>total replace count
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">37</span><span><span style="color:#fab387">594812</span></span></span></code></pre></div>
<p>Given that Rust performs many bounds checks, we can observe that it benefits significantly from the Constraint Elimination pass overall.</p>
<p>Despite successfully adding additional facts, the total number of replacements remained unchanged in both LLVM and Rust builds. It&rsquo;s unclear why this happened. One possible explanation is that these new facts did not intersect with any existing <code>icmp</code> checks eligible for replacement. Further investigation is needed to understand this behavior.</p>
<h3 id="future-work">Future Work</h3>
<p>Constraint Elimination is a fun and powerful transformation pass. There are still many missing optimizations that we can contribute. As we mentioned earlier, the current constraint system supports only logical AND for its constraints. This limitation prevents the system from learning facts expressed as <code>Fact1 || Fact2</code>. Supporting logical OR opens many optimization opportunities, such as <code>(LHS | RHS) &lt; 0 =&gt; LHS &lt; 0 || RHS &lt; 0</code>.</p>
<p>Currently, <code>ne</code> constraints are not supported in the constraint system. The reason is that <code>a != b</code> cannot be directly encoded as a single linear constraint — it represents a disjunction: <code>a &lt; b || a &gt; b</code>. However, the constraint system models all facts as conjunctions (logical ANDs) of linear inequalities. Without support for logical OR, it is not possible to store <code>ne</code> facts within the system. In contrast, <code>eq</code> facts like <code>a == b</code> can be represented as two inequalities: <code>a &lt;= b &amp;&amp; a &gt;= b</code>, both of which are individually expressible.</p>
<h3 id="conclusion">Conclusion</h3>
<p>I only worked on a certain part of the Constraint Elimination pass. There is still more to discover inside this pass, such as, adding facts for loop induction variables. Lastly, I want to express my gratitude to Dr. John Regehr for his valuable advice on this project. Thanks, John!</p>
]]></content:encoded>
    </item>
    <item>
      <title>Spring 2025: CS 6950 Compiler Independent Study</title>
      <link>https://leewei.co/cs6950/</link>
      <pubDate>Sun, 13 Apr 2025 10:34:52 -0700</pubDate><author>lee10202013@gmail.com (Lee Wei)</author>
      <guid>https://leewei.co/cs6950/</guid>
      <description>Last semester, I started contributing to LLVM by adding a missing InstCombine optimization and fixing several Undefined Behavior tests. As I became more familiar with LLVM, I wanted to contribute more impactful patches. Therefore, I asked John to advise me on doing an independent study on compilers this semester.
Planning Here are the initial project options:
LLVM Constraint Elimination missing optimization: support eq/ne and bitwise AND/OR constraints. There are two open issues that I could work on: eq/ne, bitwise AND/OR LLVM backend AArch64 optimization MLIR Synthesizer I chose to work on Constraint Elimination because I was more familiar with the development process for LLVM middle-end.</description>
      <content:encoded><![CDATA[<p>Last semester, I started contributing to LLVM by adding a missing InstCombine optimization and fixing several Undefined Behavior tests. As I became more familiar with LLVM, I wanted to contribute more impactful patches. Therefore, I asked John to advise me on doing an independent study on compilers this semester.</p>
<h3 id="planning">Planning</h3>
<p>Here are the initial project options:</p>
<ul>
<li>LLVM Constraint Elimination missing optimization: support <code>eq</code>/<code>ne</code> and bitwise <code>AND</code>/<code>OR</code> constraints.
<ul>
<li>There are two open issues that I could work on: <a href="https://github.com/llvm/llvm-project/issues/117961">eq/ne</a>, <a href="https://github.com/llvm/llvm-project/issues/118114">bitwise AND/OR</a></li>
</ul>
</li>
<li>LLVM backend AArch64 optimization</li>
<li>MLIR Synthesizer</li>
</ul>
<p>I chose to work on Constraint Elimination because I was more familiar with the development process for LLVM middle-end. The initial goal is to merge four PRs by the end of the semester.</p>
<h4 id="timeline">Timeline</h4>
<ul>
<li>4 weeks(1/6 ~ 1/31): discuss project scope, read code and test tools</li>
<li>11 weeks(2/3 ~ 4/16): implementation and testing</li>
<li>1 week(4/16 ~ 4/23): write final report</li>
</ul>
<h3 id="constraint-elimination">Constraint Elimination</h3>
<p>I wrote a blog post that introduces <a href="https://leewei05.github.io/llvm-constraint">Constraint Elimination</a>.</p>
<h3 id="testing-and-fuzzing">Testing and Fuzzing</h3>
<p>With so many patches committed to LLVM every day, it’s crucial to verify that my implementation does the right thing and doesn’t introduce new bugs. During this project, I learned several methods to help verify the correctness of my implementation.</p>
<h4 id="alive2-for-mathematical-proof">Alive2 for mathematical proof</h4>
<p><a href="https://github.com/AliveToolkit/alive2">Alive2</a> provides a fast and robust way to verify the correctness of LLVM transformations. Ever since it became available on <a href="https://alive2.llvm.org/ce/">Compiler Explorer</a>, it has become an essential tool for LLVM development. Having an <a href="https://llvm.org/docs/InstCombineContributorGuide.html#proofs">Alive2 proof link</a> is a requirement for submitting InstCombine PRs.</p>
<p>Before implementation, it’s helpful to use <a href="https://alive2.llvm.org/ce/z/roTijm">Alive2</a> to verify the correctness of updates. This gives developers confidence in their implementation and provides reviewers with a quick way to understand the proposed transformation.</p>
<h4 id="llvm-regression-tests">LLVM regression tests</h4>
<p><a href="https://llvm.org/docs/TestingGuide.html#regression-tests">LLVM regression tests</a> are located in the <code>llvm/test</code> directory. A regression test is a small piece of LLVM IR code that demonstrates a transformation. Before changing any tests, it’s recommended to run the existing tests first to ensure there are no failures.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span>$ <span style="color:#89dceb">pwd</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>/Users/lee/dev/llvm-project/build
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>$ ninja -j <span style="color:#fab387">8</span> check-llvm
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#89dceb;font-weight:bold">[</span>841/842<span style="color:#89dceb;font-weight:bold">]</span> Running the LLVM regression tests
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>Testing Time: 11154.24s
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>Total Discovered Tests: <span style="color:#fab387">63868</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>  Skipped          :   <span style="color:#fab387">359</span> <span style="color:#89dceb;font-weight:bold">(</span>0.56%<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>  Unsupported      : <span style="color:#fab387">30198</span> <span style="color:#89dceb;font-weight:bold">(</span>47.28%<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>  Passed           : <span style="color:#fab387">33238</span> <span style="color:#89dceb;font-weight:bold">(</span>52.04%<span style="color:#89dceb;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>  Expectedly Failed:    <span style="color:#fab387">73</span> <span style="color:#89dceb;font-weight:bold">(</span>0.11%<span style="color:#89dceb;font-weight:bold">)</span></span></span></code></pre></div>
<p>We then add our LLVM IR snippet to either an existing or a new <code>.ll</code> test file.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#6c7086;font-style:italic">// before
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span><span style="color:#6c7086;font-style:italic"></span>define <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>test_decompose_bitwise_and(i4 <span style="color:#89dceb;font-weight:bold">%</span>x, i4 <span style="color:#89dceb;font-weight:bold">%</span>y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#89dceb">entry</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>and<span style="color:#fab387">.1</span> <span style="color:#89dceb;font-weight:bold">=</span> and i4 <span style="color:#89dceb;font-weight:bold">%</span>y, <span style="color:#89dceb;font-weight:bold">%</span>x
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span><span style="color:#89dceb;font-weight:bold">=</span> icmp slt i4 <span style="color:#89dceb;font-weight:bold">%</span>and<span style="color:#fab387">.1</span>, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>  br i1 <span style="color:#89dceb;font-weight:bold">%</span>c<span style="color:#fab387">.1</span>, label <span style="color:#89dceb;font-weight:bold">%</span>then, label <span style="color:#89dceb;font-weight:bold">%</span>end
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span><span style="color:#89dceb">then</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>  ; <span style="color:#89dceb">fact</span>: <span style="color:#89dceb;font-weight:bold">%</span>and<span style="color:#fab387">.1</span> <span style="color:#89dceb;font-weight:bold">&lt;</span> <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>t<span style="color:#fab387">.1</span> <span style="color:#89dceb;font-weight:bold">=</span> icmp slt i4 <span style="color:#89dceb;font-weight:bold">%</span>x, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>  <span style="color:#89dceb;font-weight:bold">%</span>t<span style="color:#fab387">.2</span> <span style="color:#89dceb;font-weight:bold">=</span> icmp slt i4 <span style="color:#89dceb;font-weight:bold">%</span>y, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>  call <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>use(i1 <span style="color:#89dceb;font-weight:bold">%</span>t<span style="color:#fab387">.1</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>  call <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>use(i1 <span style="color:#89dceb;font-weight:bold">%</span>t<span style="color:#fab387">.2</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>  ret <span style="color:#f38ba8">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span><span style="color:#89dceb">end</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>  ret <span style="color:#f38ba8">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>}</span></span></code></pre></div>
<p>Then, we run the following command, where <code>update_test_checks.py</code> will apply transformations to our target file <code>and.ll</code>:</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>$ <span style="color:#89dceb">pwd</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>/Users/lee/dev/llvm-project/build
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span>$ ../llvm/utils/update_test_checks.py --opt-binary<span style="color:#89dceb;font-weight:bold">=</span>./bin/opt ../llvm/test/Transforms/ConstraintElimination/and.ll</span></span></code></pre></div>
<p>We verify the transformation in the LLVM IR using the <code>CHECK-</code> prefixes and confirm the result matches Alive2’s output.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#6c7086;font-style:italic">// after
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span><span style="color:#6c7086;font-style:italic"></span>define <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>test_decompose_bitwise_and(i4 <span style="color:#89dceb;font-weight:bold">%</span>x, i4 <span style="color:#89dceb;font-weight:bold">%</span>y) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>; CHECK<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#89dceb">LABEL</span>: <span style="color:#f38ba8">@</span>test_decompose_bitwise_and(
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>; CHECK<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#89dceb">NEXT</span>:  <span style="color:#89dceb">entry</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>; CHECK<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#89dceb">NEXT</span>:    <span style="color:#89b4fa">[[TMP0:%.*]] = and i4 [[Y:%.*]], [[X:%.*]]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>; CHECK<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#89dceb">NEXT</span>:    <span style="color:#89b4fa">[[AND:%.*]] = icmp slt i4 [[TMP0]]</span>, <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span>; CHECK<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#89dceb">NEXT</span>:    br i1 <span style="color:#89b4fa">[[AND]], label [[BB1:%.*]], label [[EXIT:%.*]]</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>; <span style="color:#89dceb">CHECK</span>:       <span style="color:#89dceb">then</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>; CHECK<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#89dceb">NEXT</span>:    call <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>use(i1 <span style="color:#89dceb">true</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>; CHECK<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#89dceb">NEXT</span>:    call <span style="color:#f38ba8">void</span> <span style="color:#f38ba8">@</span>use(i1 <span style="color:#89dceb">true</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>; CHECK<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#89dceb">NEXT</span>:    ret <span style="color:#f38ba8">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>; <span style="color:#89dceb">CHECK</span>:       <span style="color:#89dceb">end</span>:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>; CHECK<span style="color:#89dceb;font-weight:bold">-</span><span style="color:#89dceb">NEXT</span>:    ret <span style="color:#f38ba8">void</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>...
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>}</span></span></code></pre></div>
<p>Our tests should cover both positive and negative cases—including simple and complex scenarios. Designing strong test cases ensures the implementation behaves as expected and avoids regressions. Also, we should run the entire LLVM regression tests after adding our tests.</p>
<h4 id="yarpgen-for-fuzzing">YARPGen for fuzzing</h4>
<p><a href="https://github.com/intel/yarpgen/tree/v1"><code>YARPGen</code></a> is a fuzzer that randomly generates valid C/C++ programs to test compilers. The setup is straightforward—change the clang path in <code>test_sets.txt</code> and run <code>./run_gen.py</code>. I tested both <code>yarpgen v1</code> and <code>yarpgen v2 (branch stable)</code> to see which one triggered my patch more often. Version 1 triggered it significantly more.</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span>// Number of <span style="color:#89dceb">times</span> yarpgen triggered my patch
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span>lee@Lee ~/d/test&gt; cat yarpgen_v1.log | grep <span style="color:#a6e3a1">&#34;additional&#34;</span> | wc -l
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#fab387">182</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span>lee@Lee ~/d/test&gt; cat yarpgen_v2.log | grep <span style="color:#a6e3a1">&#34;additional&#34;</span> | wc -l
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span><span style="color:#fab387">0</span></span></span></code></pre></div>
<p>I ran two experiment:</p>
<ol>
<li>I ran <code>yarpgen v1</code> against my patch for several days on a 12-core machine. The goal was to ensure that no miscompilations occurred (i.e., zero compfail).</li>
</ol>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#6c7086;font-style:italic">##########################</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span>YARPGEN runs stat:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span>Time: 2025/03/13 08:44:06
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span>duration: <span style="color:#fab387">4</span> d 18:27:25
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>testing speed: 3.72 seed/min
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span><span style="color:#6c7086;font-style:italic">##########################</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>generator stat:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span>cpu time: <span style="color:#fab387">0</span> d 5:10:16
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>        total : <span style="color:#fab387">25574</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span>        ok : <span style="color:#fab387">25574</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>        runfail_timeout : <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>        runfail : <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span><span style="color:#6c7086;font-style:italic">##########################</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span>clang_no_opt stat:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>        cpu time: <span style="color:#fab387">19</span> d 3:2:24
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>        total : <span style="color:#fab387">25572</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>        ok : <span style="color:#fab387">25552</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span>        compfail_timeout : <span style="color:#fab387">20</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>        compfail : <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">22</span><span>        runfail_timeout : <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">23</span><span>        runfail : <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">24</span><span>        different_output : <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">25</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">26</span><span><span style="color:#6c7086;font-style:italic">##########################</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">27</span><span>clang_opt stat:
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">28</span><span>        cpu time: <span style="color:#fab387">30</span> d 17:48:39
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">29</span><span>        total : <span style="color:#fab387">25562</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">30</span><span>        ok : <span style="color:#fab387">25485</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">31</span><span>        compfail_timeout : <span style="color:#fab387">77</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">32</span><span>        compfail : <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">33</span><span>        runfail_timeout : <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">34</span><span>        runfail : <span style="color:#fab387">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">35</span><span>        different_output : <span style="color:#f5e0dc">0</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">36</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">37</span><span><span style="color:#89dceb;font-weight:bold">=================================</span></span></span></code></pre></div>
<ol start="2">
<li>I purposely introduced a bug in my patch and reran <code>yarpgen v1</code>. It successfully found a miscompilation. However, the generated program was quite large, so I used <code>C-Reduce</code> to shrink it into a minimal test case.</li>
</ol>
<h4 id="c-reduce-to-minimize-program">C-Reduce to minimize program</h4>
<p><a href="https://github.com/csmith-project/creduce">C-Reduce</a> reduces a large C/C++ file into a smaller test case while preserving the bug. It does this using an <strong>interestingness test (a shell script)</strong>. As long as the test returns 0, the reduced program is still interesting.</p>
<p>For example, I considered the outputs below to be &ldquo;interesting&rdquo;:</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">1</span><span><span style="color:#6c7086;font-style:italic"># correct version</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">2</span><span><span style="color:#f5e0dc">$LLVM_HOME</span>/bin/clang++ -O3 <span style="color:#f5e0dc">$CXXFLAGS</span> driver.cpp func.cpp init.h <span style="color:#89dceb;font-weight:bold">&amp;&amp;</span> ./a.out
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">3</span><span><span style="color:#fab387">9133052109159997938</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">5</span><span><span style="color:#6c7086;font-style:italic"># miscompilation</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">6</span><span><span style="color:#f5e0dc">$LLVM_HOME</span>/bin/clang++ -O3 <span style="color:#f5e0dc">$CXXFLAGS</span> driver.cpp func.cpp init.h <span style="color:#89dceb;font-weight:bold">&amp;&amp;</span> ./a.out
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">7</span><span><span style="color:#fab387">7336395106169927387</span></span></span></code></pre></div>
<p>I would like the miscompiled result to be different from the correct version, and that would be <code>interesting</code> for this test case. Therefore, I wrote this <code>test1.sh</code> to reduce the generated program. There are several details in this shell script.</p>
<ol>
<li>Enabling UBSan during compilation is essential, as we don’t want C-Reduce to minimize a program that exhibits undefined behavior. This requires compiling LLVM with <code>compiler-rt</code> enabled.</li>
<li>Precompile <code>driver.cpp</code> and link it separately to reduce overall compile time during test case reduction.</li>
<li>Set <code>ulimit</code> for both virtual memory and CPU time to prevent resource exhaustion.</li>
</ol>
<p>Here’s the <code>test1.sh</code> script I used with C-Reduce:</p>






<div class="highlight"><pre tabindex="0" style="color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 1</span><span><span style="color:#6c7086;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 2</span><span><span style="color:#6c7086;font-style:italic"></span><span style="color:#89dceb">set</span> -x
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 3</span><span><span style="color:#89dceb">ulimit</span> -t <span style="color:#fab387">800</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 4</span><span><span style="color:#89dceb">ulimit</span> -v <span style="color:#fab387">2000000</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 5</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 6</span><span><span style="color:#f5e0dc">LOGFILE</span><span style="color:#89dceb;font-weight:bold">=</span><span style="color:#a6e3a1">&#34;script.log&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 7</span><span><span style="color:#89dceb">exec</span> &gt; <span style="color:#a6e3a1">&#34;</span><span style="color:#f5e0dc">$LOGFILE</span><span style="color:#a6e3a1">&#34;</span> 2&gt;&amp;<span style="color:#fab387">1</span>  <span style="color:#6c7086;font-style:italic"># Redirect both stdout and stderr to the log file</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c"> 9</span><span><span style="color:#6c7086;font-style:italic"># Compile both versions</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">10</span><span>/home/lee/dev/llvm-project/build/bin/clang++ -O3 -Xclang -disable-llvm-optzns <span style="color:#89b4fa">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">11</span><span><span style="color:#89b4fa"></span>    -fsanitize<span style="color:#89dceb;font-weight:bold">=</span>undefined -fno-sanitize-recover<span style="color:#89dceb;font-weight:bold">=</span>undefined func.cpp driver.o -o no_opt <span style="color:#89dceb;font-weight:bold">||</span> <span style="color:#89dceb;font-weight:bold">{</span> <span style="color:#89dceb">echo</span> <span style="color:#a6e3a1">&#34;Compilation of no_opt failed!&#34;</span> &gt;&amp;2; <span style="color:#89dceb">exit</span> 1; <span style="color:#89dceb;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">13</span><span>/home/lee/dev/llvm-project/build/bin/clang++ -O3 <span style="color:#89b4fa">\
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">14</span><span><span style="color:#89b4fa"></span>    -fsanitize<span style="color:#89dceb;font-weight:bold">=</span>undefined -fno-sanitize-recover<span style="color:#89dceb;font-weight:bold">=</span>undefined func.cpp driver.o -o opt <span style="color:#89dceb;font-weight:bold">||</span> <span style="color:#89dceb;font-weight:bold">{</span> <span style="color:#89dceb">echo</span> <span style="color:#a6e3a1">&#34;Compilation of opt failed!&#34;</span> &gt;&amp;2; <span style="color:#89dceb">exit</span> 1; <span style="color:#89dceb;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">16</span><span><span style="color:#6c7086;font-style:italic"># Run both versions</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">17</span><span>./no_opt <span style="color:#89dceb;font-weight:bold">||</span> <span style="color:#89dceb;font-weight:bold">{</span> <span style="color:#89dceb">echo</span> <span style="color:#a6e3a1">&#34;Execution of no_opt failed!&#34;</span> &gt;&amp;2; <span style="color:#89dceb">exit</span> 1; <span style="color:#89dceb;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">18</span><span>./opt <span style="color:#89dceb;font-weight:bold">||</span> <span style="color:#89dceb;font-weight:bold">{</span> <span style="color:#89dceb">echo</span> <span style="color:#a6e3a1">&#34;Execution of opt failed!&#34;</span> &gt;&amp;2; <span style="color:#89dceb">exit</span> 1; <span style="color:#89dceb;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">19</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">20</span><span><span style="color:#6c7086;font-style:italic"># Compare outputs</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f849c">21</span><span>! diff &lt;<span style="color:#89dceb;font-weight:bold">(</span>./no_opt<span style="color:#89dceb;font-weight:bold">)</span> &lt;<span style="color:#89dceb;font-weight:bold">(</span>./opt<span style="color:#89dceb;font-weight:bold">)</span> <span style="color:#89dceb;font-weight:bold">||</span> <span style="color:#89dceb;font-weight:bold">{</span> <span style="color:#89dceb">echo</span> <span style="color:#a6e3a1">&#34;Outputs are the same, test case reduction is invalid!&#34;</span> &gt;&amp;2; <span style="color:#89dceb">exit</span> 1; <span style="color:#89dceb;font-weight:bold">}</span></span></span></code></pre></div>
<p>After C-Reduce, the program was small enough to inspect and reduce by hand. Here’s the final <a href="https://gcc.godbolt.org/z/EP9YMGosv">func.cpp</a>. The incorrect patch optimized any bitwise OR compared with 0, regardless of the predicate. Here’s the <a href="https://alive2.llvm.org/ce/z/SBJ5W8">Alive2 proof</a> comparing correct and incorrect versions.</p>
<p>These testing and fuzzing tools gave me much more confidence in my implementation and helped prepare it for a Pull Request.</p>
<h3 id="conclusion">Conclusion</h3>
<p>Here&rsquo;s three PRs I submitted:</p>
<ul>
<li>(Closed) <a href="https://github.com/llvm/llvm-project/pull/126158">https://github.com/llvm/llvm-project/pull/126158</a></li>
<li>(Merged) <a href="https://github.com/llvm/llvm-project/pull/127351">https://github.com/llvm/llvm-project/pull/127351</a></li>
<li>(Under review) <a href="https://github.com/llvm/llvm-project/pull/132124">https://github.com/llvm/llvm-project/pull/132124</a></li>
</ul>
<p>Even though I didn’t manage to submit all four PRs, I learned a great deal from the development and testing process. My first PR wasn’t implemented in the right place, and I’ve since learned the value of reaching out to LLVM developers earlier.</p>
<p>It was fun doing this project, and it made me learn to think like a compiler engineer. It isn&rsquo;t easy to work on compilers, especially an industrial-level compiler like LLVM, but it sure is rewarding when finally submitted a PR to LLVM. I would like to show my appreciation to Dr. John Regehr for advising me on this project. Thanks, John!</p>
]]></content:encoded>
    </item>
  </channel>
</rss>
