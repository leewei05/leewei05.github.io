<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>CMU Databases Systems: 04 Database Storage(pt.2) - Sir</title><meta name="Description" content=""><meta property="og:title" content="CMU Databases Systems: 04 Database Storage(pt.2)" />
<meta property="og:description" content="Andy(lecturer) said that in the early 2000s, Google is making tons of money. And one of the reason Google is expanding and scaling so fast is because they are using HBase, which is called &ldquo;BigTable&rdquo; on GCP. Google is absolutely good at large scale database systems, like Spanner, BigQuery etc. A lot of companies are trying to copy the tech stack of Google. Nevertheless, not all the companies that uses Google Cloud Platform are enterprise level companies, most of them don&#39;t have the resource like Google to develop applications using large scale databases." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.leewei.co/posts/cmu-15-445/database-storage-02/" />
<meta property="article:published_time" content="2020-05-13T22:26:52+08:00" />
<meta property="article:modified_time" content="2020-05-13T22:26:52+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CMU Databases Systems: 04 Database Storage(pt.2)"/>
<meta name="twitter:description" content="Andy(lecturer) said that in the early 2000s, Google is making tons of money. And one of the reason Google is expanding and scaling so fast is because they are using HBase, which is called &ldquo;BigTable&rdquo; on GCP. Google is absolutely good at large scale database systems, like Spanner, BigQuery etc. A lot of companies are trying to copy the tech stack of Google. Nevertheless, not all the companies that uses Google Cloud Platform are enterprise level companies, most of them don&#39;t have the resource like Google to develop applications using large scale databases."/>
<meta name="application-name" content="Sir">
<meta name="apple-mobile-web-app-title" content="Sir"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.leewei.co/posts/cmu-15-445/database-storage-02/" /><link rel="prev" href="https://www.leewei.co/posts/cmu-15-445/database-storage-01/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CMU Databases Systems: 04 Database Storage(pt.2)",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.leewei.co\/posts\/cmu-15-445\/database-storage-02\/"
        },"genre": "posts","keywords": "CMU, 15-445","wordcount":  886 ,
        "url": "https:\/\/www.leewei.co\/posts\/cmu-15-445\/database-storage-02\/","datePublished": "2020-05-13T22:26:52+08:00","dateModified": "2020-05-13T22:26:52+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","author": {
                "@type": "Person",
                "name": "Lee Wei"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Sir">Sir</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/tags/"> Tags </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Sir">Sir</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/tags/" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animated flipInX">CMU Databases Systems: 04 Database Storage(pt.2)</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Lee Wei</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-05-13>2020-05-13</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>&nbsp;about 886 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;5 min&nbsp;</div>
        </div><div class="content" id="content"><p>Andy(lecturer) said that in the early 2000s, Google is making tons of money.
And one of the reason Google is expanding and scaling so fast is because they are using HBase, which is called &ldquo;BigTable&rdquo; on GCP.
Google is absolutely good at large scale database systems, like Spanner, BigQuery etc.
A lot of companies are trying to copy the tech stack of Google.
Nevertheless, not all the companies that uses Google Cloud Platform are enterprise level companies, most of them don't have the resource like Google to develop applications using large scale databases.</p>
<p>A stable RDBMS service is good enough for most of the users.
For instance, Cloud SQL is a managed RDBMS service for MySQL, PostgreSQL, SQL server on GCP.
Cloud SQL lacks tons of native support and the real pain using it is the <code>maintanence window</code>.
GCP forces users to enable automatically update in a period of time because of security reasons.
However, a lot of GCP users complained about this.
Because during the maintanence window, there will be downtime to the database.
Maybe GCP can release a feature that let the users choose whether they want to update their databases. üòú</p>
<p>In addition, there are complaints about the failover process of Cloud SQL.
Some said that the failover didn't work when one of their Cloud SQL master failed. üòÖ</p>
<p>There are still many improvements that GCP can do with Cloud SQL.
Including the support for MariaDB and Oracle, stable service and easier database migration tools.</p>
<p>Just some advices, still a fan for GCP. üòÇ</p>
<h2 id="data-representation">Data Representation</h2>
<p>Tuple storage: a tuple is a sequence of bytes.
DBMS interpret those bytes into types and values.</p>
<ul>
<li>Variable Precision Numbers
<ul>
<li>Inexact, specified by IEEE-754</li>
<li>Faster to compute</li>
<li>Examples: FLOAT, REAL</li>
</ul>
</li>
<li>Fixed Point Precision Numbers(Fixed Point Decimal)</li>
<li>Large Values
<ul>
<li>Most DBMS don't allow tuples to exceed the size of a single page</li>
<li>Postgres: <a href="https://wiki.postgresql.org/wiki/TOAST" target="_blank" rel="noopener noreffer">TOAST</a></li>
</ul>
</li>
<li>External Value Storage
<ul>
<li>Some DBMS allows users to store very large data in an external file(BLOB type)</li>
<li>These external files are read-only</li>
</ul>
</li>
</ul>
<pre><code>Tuple
| Header | a | b | c(external file pointer) |
</code></pre><h3 id="system-catalogs">System Catalogs</h3>
<p>A DBMS stores meta-data about databases in its internal catalogs.
Stuff like what tables, columns and data type that stored in the database.</p>
<p>We can access to database's catalogs through INFORMATION_SCHEMA api.</p>
<h2 id="workloads">Workloads</h2>
<h3 id="on-line-transaction-processingoltp">On-line Transaction Processing(OLTP)</h3>
<ul>
<li>Fast, short running operations on small number of tuples</li>
<li>Usually the kind of application that people build first</li>
<li>Example: User invocations of Amazon. They can add things to their cart, they can make purchases,
but the actions only affect their account.</li>
</ul>
<h3 id="on-line-analytics-processingolap">On-line Analytics Processing(OLAP)</h3>
<ul>
<li>Long running, more complex queries</li>
<li>Reads large portions of the database</li>
<li>Deriving new data from data collected on the OLTP side</li>
<li>Example: Compute the five most bought items over a one month period for these geographical locations.</li>
</ul>
<h3 id="hybrid-transactionalanalytical-processinghtaphttpsenwikipediaorgwikihybrid-transactionalanalytical-processing"><a href="https://en.wikipedia.org/wiki/Hybrid_transactional/analytical_processing" target="_blank" rel="noopener noreffer">Hybrid Transactional/Analytical Processing(HTAP)</a></h3>
<p>Traditional application architectures separated transactional and analytical systems.
However, business moments are <code>transient</code> opportunities that must be exploited in real time.
HTAP allows advanced analytics to be run in real time on &ldquo;in flight&rdquo; transaction data, providing an architecture that empowers users to respond more effectively to business moments.</p>
<h2 id="storage-models">Storage Models</h2>
<p>Different ways to store tuples in pages.</p>
<h3 id="n-ary-storage-modelnsm">N-ary Storage Model(NSM)</h3>
<p>The DBMS stores all of the attributes for a single tuple contiguously, also known as &ldquo;row storage&rdquo;.</p>
<ul>
<li>Advantages
<ul>
<li>Fast inserts, updates, and deletes.</li>
<li>Good for queries that need the entire tuple.</li>
</ul>
</li>
<li>Disadvantages
<ul>
<li>Not good for scanning large portions of the table and/or a subset of the attributes. This is because the database will fetch data that is not needed for processing the query.</li>
</ul>
</li>
</ul>
<p>There is an example below, explaining why NSM is not suitable for OLAP. We are trying to know the users amount that modify WIKI from hostname &lsquo;.gov&rsquo; in each month.</p>
<div class="highlight"><pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="k">Table</span> <span class="k">SCHEMA</span> <span class="k">in</span> <span class="n">useracct</span>
<span class="n">userID</span>
<span class="n">userName</span>
<span class="n">userPass</span>
<span class="n">hostName</span>
<span class="n">lastlogin</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="k">SELECT</span> 
  <span class="k">COUNT</span><span class="p">(</span><span class="n">U</span><span class="p">.</span><span class="n">lastlogin</span><span class="p">)</span>
  <span class="k">EXTRACT</span><span class="p">(</span><span class="k">month</span> <span class="k">FROM</span> <span class="n">U</span><span class="p">.</span><span class="n">lastlogin</span><span class="p">)</span> <span class="k">AS</span> <span class="k">month</span>
<span class="k">FROM</span> 
  <span class="n">useracct</span> <span class="k">AS</span> <span class="n">U</span>
<span class="k">WHERE</span>
  <span class="n">U</span><span class="p">.</span><span class="n">hostname</span> <span class="k">LIKE</span> <span class="s1">&#39;</span><span class="s1">%.gov</span><span class="s1">&#39;</span>
<span class="k">GROUP</span> <span class="k">BY</span>
  <span class="k">EXTRACT</span><span class="p">(</span><span class="k">month</span> <span class="k">FROM</span> <span class="n">U</span><span class="p">.</span><span class="n">lastlogin</span><span class="p">)</span>
</code></pre></div><p>We only use the column <code>lastlogin</code> and <code>hostname</code> in table <code>useracct</code>. However, the buffer pool will still pull all of the data in the disk page since we stored the data in block base on the disk. This will end up wasting memory to get useless data in this query(userID, userName, userPass are not being used).</p>
<h3 id="decomposition-storage-modeldsm">Decomposition Storage Model(DSM)</h3>
<p>The DBMS stores a single attribute (column) for all tuples contiguously in a block of data. Also known as a
‚Äúcolumn store.‚Äù Ideal for OLAP workloads.</p>
<ul>
<li>Advantages
<ul>
<li>Reduces the amount of wasted work during query execution because the DBMS only reads the data that it needs for that query.</li>
<li>Enables better compression because all of the values for the same attribute are stored contiguously.</li>
</ul>
</li>
<li>Disadvantages
<ul>
<li>Slow for point queries, inserts, updates, and deletes because of tuple splitting/stitching.</li>
</ul>
</li>
</ul>
<p>To put the tuples back together when we are using a column store, we can use:</p>
<ul>
<li>Fixed-length offsets: the attributes are all fixed-length. Then when the system
wants the attribute for a specific tuple, it knows how to jump to that spot in the file.</li>
<li>Embedded Tuple Ids: For every attribute in the columns, store the tuple id with it. The system would
also need extra information to tell it how to jump to every attribute that has that id.</li>
</ul>
<p><strong>Most DBMSs use fixed-length offsets.</strong></p>
<p>Row stores are usually better for OLTP, while column stores are better for OLAP.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>The article was updated on 2020-05-13</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/cmu/">CMU</a>,&nbsp;<a href="/tags/15-445/">15-445</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/cmu-15-445/database-storage-01/" class="prev" rel="prev" title="CMU Databases Systems: 03 Database Storage(pt.1)"><i class="fas fa-angle-left fa-fw"></i>CMU Databases Systems: 03 Database Storage(pt.1)</a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.62.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.8"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Lee Wei</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><script type="text/javascript" src="/lib/gitalk/gitalk.min.js"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"gitalk":{"admin":["leewei05"],"clientID":"0138230ec774a37ccb96","clientSecret":"105dc57b6c411999d2e8a97171ac0578fd6a6a8b","id":"2020-05-13T22:26:52+08:00","owner":"leewei05","repo":"leewei05.github.io","title":"CMU Databases Systems: 04 Database Storage(pt.2)"}}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
