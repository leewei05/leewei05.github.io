<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>CMU Databases Systems: 03 Database Storage(pt.1) - Sir</title><meta name="Description" content=""><meta property="og:title" content="CMU Databases Systems: 03 Database Storage(pt.1)" />
<meta property="og:description" content="Course Outline The main purpose of this course is How to build a software of database management system.
Storage  Volatile Devices: it needs power to keep its data persistent. Non-Volatile Devices: does not need continous power for device to retain its data.  Non-Volatile Memory: a storage device that is almost as fast as DRAM but with the persistence of a disk.
Disk-Oriented DBMS The data in the database files is organized into pages, and the first page is the directory page." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.leewei.co/posts/cmu-15-445/database-storage-01/" />
<meta property="article:published_time" content="2020-04-13T20:26:07+08:00" />
<meta property="article:modified_time" content="2020-04-13T20:26:07+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CMU Databases Systems: 03 Database Storage(pt.1)"/>
<meta name="twitter:description" content="Course Outline The main purpose of this course is How to build a software of database management system.
Storage  Volatile Devices: it needs power to keep its data persistent. Non-Volatile Devices: does not need continous power for device to retain its data.  Non-Volatile Memory: a storage device that is almost as fast as DRAM but with the persistence of a disk.
Disk-Oriented DBMS The data in the database files is organized into pages, and the first page is the directory page."/>
<meta name="application-name" content="Sir">
<meta name="apple-mobile-web-app-title" content="Sir"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.leewei.co/posts/cmu-15-445/database-storage-01/" /><link rel="prev" href="https://www.leewei.co/posts/2020/postgre-sql-set-up/" /><link rel="next" href="https://www.leewei.co/posts/cmu-15-445/database-storage-02/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "CMU Databases Systems: 03 Database Storage(pt.1)",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.leewei.co\/posts\/cmu-15-445\/database-storage-01\/"
        },"genre": "posts","keywords": "CMU, 15-445","wordcount":  959 ,
        "url": "https:\/\/www.leewei.co\/posts\/cmu-15-445\/database-storage-01\/","datePublished": "2020-04-13T20:26:07+08:00","dateModified": "2020-04-13T20:26:07+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","author": {
                "@type": "Person",
                "name": "Lee Wei"
            },"description": ""
    }
    </script></head>
    <body header-desktop="" header-mobile=""><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Sir">Sir</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/tags/"> Tags </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Sir">Sir</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/tags/" title="">Tags</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">CMU Databases Systems: 03 Database Storage(pt.1)</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Lee Wei</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-04-13>2020-04-13</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>&nbsp;about 959 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;5 min&nbsp;</div>
        </div><div class="details toc" id="toc-static">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#course-outline">Course Outline</a></li>
    <li><a href="#storage">Storage</a></li>
    <li><a href="#disk-oriented-dbms">Disk-Oriented DBMS</a></li>
    <li><a href="#why-not-use-the-os">Why not use the OS?</a></li>
    <li><a href="#file-storage">File Storage</a></li>
    <li><a href="#database-pages">Database Pages</a>
      <ul>
        <li><a href="#three-important-concept-in-pages">Three Important concept in pages:</a></li>
      </ul>
    </li>
    <li><a href="#database-heap">Database Heap</a></li>
    <li><a href="#page-layout">Page Layout</a>
      <ul>
        <li><a href="#slotted-pages-page-maps-slots-to-offsets">Slotted Pages: Page maps slots to offsets.</a></li>
        <li><a href="#log-structured-instead-of-storing-tuples-the-dbms-only-stores-log-records">Log-Structured: Instead of storing tuples, the DBMS only stores log records</a></li>
      </ul>
    </li>
    <li><a href="#tuple-layout">Tuple Layout</a>
      <ul>
        <li><a href="#tuple-header-contains-meta-data-about-the-tuple">Tuple Header: Contains meta-data about the tuple</a></li>
        <li><a href="#tuple-data-actual-data-for-attributes">Tuple Data: Actual data for attributes</a></li>
        <li><a href="#unique-identifierrecord-id">Unique Identifier(Record ID)</a></li>
        <li><a href="#denormalized-tuple-data">Denormalized Tuple Data</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="course-outline">Course Outline</h2>
<p>The main purpose of this course is <code>How to build a software of database management system.</code></p>
<h2 id="storage">Storage</h2>
<ul>
<li>Volatile Devices: it needs power to keep its data persistent.</li>
<li>Non-Volatile Devices: does not need continous power for device to retain its data.</li>
</ul>
<p><strong>Non-Volatile Memory</strong>: a storage device that is almost as fast as DRAM but with the persistence of a disk.</p>
<h2 id="disk-oriented-dbms">Disk-Oriented DBMS</h2>
<p>The data in the database files is organized into pages, and the first page is the directory page.</p>
<pre><code>Execution Engine: execute queries
      |
      | ask for specific page(block)
      |
Buffer Pool: The buffer pool manager will ensure that the page is there while the
execution engine is operating on that memory.
      |
      | manages the movement back and forth between disk and memory
      |
Disk: save database files 
</code></pre><h2 id="why-not-use-the-os">Why not use the OS?</h2>
<p>The operating system doesn't know about what data the user wants to query, and how to operates the data in efficiency.</p>
<p>This high-level design goal is like virtual memory, where there is a large address space and a place for the
OS to bring in pages from disk.</p>
<p><strong>Never use <code>mmap</code> in your DBMS if you need to write.</strong></p>
<p>Having the DBMS implement these procedures itself gives it better control and performance</p>
<h2 id="file-storage">File Storage</h2>
<p>DBMS stores a database as files on disk.</p>
<p>The OS does not know anything about the contents of these files. Only the DBMS knows how to decipher
their contents, since it is encoded in a way specific to the DBMS.</p>
<p>The DBMS’s <code>storage manager</code>is responsible for managing a database’s files</p>
<h2 id="database-pages">Database Pages</h2>
<p>The DBMS organizes the database across one or more files in fixed-size blocks of data called <code>pages</code>.</p>
<ul>
<li>Pages contain different type of data</li>
<li>Most DBMS don't mix up types in one page</li>
<li>Some DBMS require self-contained pages, which means all the information needed to read the page is in the page itself</li>
<li>Most DBMS use fixed-size pages to avoid the engineering overhead</li>
</ul>
<h3 id="three-important-concept-in-pages">Three Important concept in pages:</h3>
<ol>
<li>Hardware page (usually 4 KB).</li>
<li>OS page (4 KB).</li>
<li>Database page (1-16 KB).</li>
</ol>
<p>The storage device guarantees an atomic write of the size of the hardware page(<code>failsafe write</code>). If the hardware page is
4 KB, then when the system tries to write 4 KB to the disk, either all 4 KB will be written, or none of it will.
This means that if our database page is larger than our hardware page, the DBMS will have to take extra
measures to ensure that the data gets written out safely since the program can get partway through writing a
database page to disk when the system crashes.</p>
<p>There are trade-offs between the size of the Hardware page and the Database page.</p>
<h2 id="database-heap">Database Heap</h2>
<p>A heap file organization is one of the ways to find the location of the page.
A heap file is an unordered collection of pages where tuples are stored in random order.</p>
<p>The DBMS can locate a page by using <code>Linked List</code> or <code>Page Directory</code>:</p>
<ul>
<li><code>Linked List</code>: Header page holds pointers to to a list of free pages and a list of data pages. However,
if the DBMS is looking for a specific page, it has to do a sequential scan on the data page list until it
finds the page it is looking for.</li>
<li><code>Page Directory</code>: DBMS maintains special pages that track locations of data pages along with the
amount of free space on each page.</li>
</ul>
<h2 id="page-layout">Page Layout</h2>
<p>Every page includes a header that records meta-data about the page’s contents:</p>
<ul>
<li>Page size</li>
<li>Checksum</li>
<li>DBMS version</li>
<li>Transaction visibility</li>
<li>Some systems require pages to be self-contained (e.g oracle)</li>
</ul>
<p>A <code>strawman approach</code> appends a new tuple to the end. However, problems arise when it
deletes a tuple or when the tuples have variable-length attributes.</p>
<p>There are two main approaches to laying out data in pages:</p>
<h3 id="slotted-pages-page-maps-slots-to-offsets">Slotted Pages: Page maps slots to offsets.</h3>
<ul>
<li>Most common approach used in DBMSs today</li>
<li>Header keeps track of the number of used slots and the offset of the starting location of last used slot
and a slot array, which keeps track of the location of the start of each tuple.</li>
<li>To add a tuple, the slot array will grow from the beginning to the end, and the data of the tuples will
grow from end to the beginning. The page is considered full when the slot array and the tuple data
meet.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading/small.min.svg"
        data-src="/img/slotted-pages.png"
        data-srcset="/img/slotted-pages.png, /img/slotted-pages.png 1.5x, /img/slotted-pages.png 2x"
        data-sizes="auto"
        alt="Slotted-Pages"
        title="Slotted-Pages" />
<a href="https://15445.courses.cs.cmu.edu/fall2019/slides/03-storage1.pdf" target="_blank" rel="noopener noreffer">Original Slides</a></p>
<h3 id="log-structured-instead-of-storing-tuples-the-dbms-only-stores-log-records">Log-Structured: Instead of storing tuples, the DBMS only stores log records</h3>
<ul>
<li>Stores records to file of how the database was modified (insert, update, deletes)</li>
<li>To read a record, the DBMS scans the log file backwards and “recreates” the tuple</li>
<li>Fast writes, potentially slow reads</li>
<li>Works well on append-only storage because the DBMS cannot go back and update the data</li>
</ul>
<h2 id="tuple-layout">Tuple Layout</h2>
<p>A tuple is a sequence of bytes. It is DBMS’s job to interpret those bytes into attribute types and values.</p>
<h3 id="tuple-header-contains-meta-data-about-the-tuple">Tuple Header: Contains meta-data about the tuple</h3>
<ul>
<li>Visibility information for the DBMS’s concurrency control protocol</li>
<li>Bit Map for NULL values</li>
<li>Note that the DBMS does not need to store meta-data about the schema of the database here</li>
</ul>
<h3 id="tuple-data-actual-data-for-attributes">Tuple Data: Actual data for attributes</h3>
<ul>
<li>Attributes are typically stored in the order that you specify them when you create the table</li>
<li>Most DBMSs do not allow a tuple to exceed the size of a page</li>
</ul>
<h3 id="unique-identifierrecord-id">Unique Identifier(Record ID)</h3>
<ul>
<li>Each tuple in the database is assigned a unique identifier</li>
<li>Most common: page id + (offset or slot)</li>
</ul>
<h3 id="denormalized-tuple-data">Denormalized Tuple Data</h3>
<p>If two tables are related, the DBMS can “pre-join” them, so the tables end up
on the same page. This makes reads faster since the DBMS only has to load in one page rather than two
separate pages, but it makes updates more expensive since the DBMS needs more space for each tuple.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>The article was updated on 2020-04-13</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/cmu/">CMU</a>,&nbsp;<a href="/tags/15-445/">15-445</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/2020/postgre-sql-set-up/" class="prev" rel="prev" title="PostgreSQL: Server setup on Ubuntu 18.04"><i class="fas fa-angle-left fa-fw"></i>PostgreSQL: Server setup on Ubuntu 18.04</a>
            <a href="/posts/cmu-15-445/database-storage-02/" class="next" rel="next" title="CMU Databases Systems: 04 Database Storage(pt.2)">CMU Databases Systems: 04 Database Storage(pt.2)<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="disqus_thread" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://disqus.com/?ref_noscript">Disqus</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.62.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.8"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Lee Wei</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://disqus_9jmj50Pr2z.disqus.com/embed.js" defer></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
